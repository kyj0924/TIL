# 무중단 배포의 3가지 방식과 장단점

무중단 배포란 서비스를 중단하지 않은 상태를 유지하면서 유저들에게 새로운 버전을 배포하는 것이다. 즉, 유저의 트래픽을 계속 처리하면서 업데이트를 동시에 진행하고 새로운 버전으로 유저의 트래픽을 옮기는 작업이다.

## 1. 롤링

설정한 조건에 따라 서버 일부를 새로운 버전으로 점차 업데이트한다. 이때 유저의 트래픽은 기존 버전의 서버에 남아있게 되고 마지막 서버가 업데이트 되었을때 최종적으로 모든 유저의 트래픽이 새로운 버전으로 이동한다.
블루그린에 비해 적은 양의 서버를 이용하기 때문에 데이터가 적게 들고, 비용적으로도 장점이 있으나, 서버가 업데이트 될수록 기존 버전의 서버에 트래픽이 몰리면서 기존 유저를 모두 받을 수 없고, 과도한 트래픽으로 인한 서버 장애가 생길 수 있다는 단점이 있다. 이외에도 구버전의 서버와 신버전의 서버가 공존하기 때문에 업데이트가 진행되는 동안 문제가 발생하게 되면 어느 서버에서 문제가 발생했는지 바로 확인하기 어렵다는 단점과 구버전과 신버전이 동시에 존재하므로 호환성 문제가 발생할 수 있다는 단점이 있다.

## 2. 블루그린

기존 서버와 같은 환경의 서버를 구축하고 업데이트하고, 한 번에 모든 트래픽을 업데이트된 서버 환경으로 옮기는 방식이다. 업데이트 완료 전까지 모든 유저의 트래픽은 기존 버전의 서버에 남아있게 되고, 업데이트 완료 시 모든 유저의 트래픽이 한 번에 새로운 버전의 서버로 이동한다.
롤링이 기존 유저를 모두 감당할 수 없다는 것에 비해, 블루그린 방식은 모든 유저의 트래픽이 기존 서버에 있다가 한 번에 새로운 버전의 서버로 이동하므로, 기존에 감당하고 있던 트래픽을 무리없이 계속 유지할 수 있다는 장점이 있다. 또한 롤링과 달리 구버전의 서버와 신버전의 서버가 독립적으로 존재하므로, 업데이트 이후 문제 발생 시 어느 서버에서 문제가 발생했는지 바로 확인할 수 있다는 장점도 있다. 하지만 롤링에 비해 두 배로 많은 양의 서버를 이용해야 하기 때문에 데이터가 많이 들고, 서버를 유지하기 위한 비용 등 비용적인 측면에서 더 많은 지출이 발생할 수 있다는 단점이 있다.

## 3. 카나리

롤링 방식과 블루그린 방식의 단점을 보완한 방식으로, 서버의 개수와 배포 방식은 롤링과 비슷하다. 롤링 방식처럼 설정한 조건에 따라 서버 일부를 새로운 버전으로 점차 업데이트 하는 것은 같으나, 롤링과는 달리 트래픽의 일부를 정해진 규칙에 따르거나 랜덤한 방식으로 신버전으로 옮긴다. 따라서 롤링과는 달리 트래픽 부담이 늘어날 위험성이 적고, 업데이트 중 문제 발생 시 구버전과 신버전 중 어느 곳에서 문제가 발생했는지도 명확하게 확인할 수 있다. 또한 두 배의 많은 양의 서버를 사용하는 블루그린과는 달리 적은 양의 서버를 사용하기 때문에 블루그린의 단점도 보완하여 불필요한 데이터 사용과 비용적 측면에서의 지출을 줄일 수 있다. 하지만 카나리 방식도 롤링 방식과 마찬가지로 구버전과 신버전이 동시에 존재하는 것은 같기 때문에 호환성 문제가 발생할 수 있다는 단점은 여전히 존재한다.

# 트래픽 관리

## scale up

scale up은 기존 서버의 성능을 높이는 것을 의미한다. 4코어짜리 CPU를 8코어로 바꾸거나, 8GB램을 16GB램으로 바꾸는 작업처럼 더 좋은 성능을 가진 서버로 업그레이드 하는 것을 말한다.

## scale out

scale out은 기존 서버를 유지한 채 서버의 개수를 늘리는 것이다. 기존에 4코어짜리 CPU가 있었다면 4코어짜리든 다른 성능이든 새로운 CPU들을 더 늘려서 여러 컴퓨터를 사용하면서 서버를 늘리는 방식을 말한다.

## 로드 밸런서의 기능과 역할

로드 밸런서는 서버에 가해지는 트래픽 부담을 분산시켜서 각 서버들이 공평하게 분담하게 만드는 역할을 수행한다. 처음에는 적은 양의 트래픽을 기존의 서버가 감당할 수 있겠지만 점차 트래픽이 증가하면 서버의 성능을 높이거나 여러 개의 서버를 운영하는 등 조치가 필요하다. 이때 서버가 1개이고, 성능이 매우 뛰어나서 모든 트래픽을 감당할 수 있는 것이 아니라면 여러 개의 서버가 트래픽을 분담하여 서버에 무리가 가지 않게 하는 것이 효율적인 방식일 것이다. 로드 밸런서는 여러 개의 서버를 사용할 때 주로 활용된다.

# MSA와 모놀리식 아키텍쳐의 차이와 각각의 장단점

모놀리식은 소프트웨어의 모든 구성요소가 한 서버에 통합되어 있는 형태로, 소규모일 경우 하나의 서버가 모든 기능을 수행할 수 있어서 편리하다는 장점이 있다. 하지만 서버를 업데이트 할때마다 서버 전체를 꺼야하고, 오류 발생 시 모든 서비스에 문제가 생긴다는 단점이 있다. 또한 많은 양의 코드로 인해 유지보수가 어렵고, 모든 기능을 가지고 있는 하나의 서버로 운영되기 때문에 scale up만 가능하다는 단점이 있다.

MSA는 마이크로서비스 아키텍처로 하나의 어플을 역할에 따라 서버를 분리하여 각 서버가 각 역할을 분담하는 형태이다. MSA 방식에서는 오류발생 또는 업데이트 진행 시 필요한 서버만 끄고 조치를 취할 수 있기 때문에 전체 서비스의 중단이 발생하지 않는다는 장점이 있다. 또한 scale out이 가능하여 부담을 분담하여 메모리 관리에 효율적이다. 다만 서비스가 증가할수록 복잡해지기 때문에 관리를 위해 많은 인력이 필요하고, 비용적인 측면에서도 많은 지출이 발생한다는 단점이 있다.

# Stateless와 Stateful의 차이

Stateless는 순서, 시간 등의 다양한 상태에 영향을 받지 않고 독립적이다. Stateless는 입력이 같으면 같은 결과를 도출한다.
반면 Stateful은 상태에 영향을 받아서 입력이 같더라도 다른 결과가 도출될 수 있다.
하지만 Stateless와 Stateful을 구분할 때는 결과만으로 구분해서는 안된다. 같은 입력에 따라 다른 응답을 받더라도 Stateless일 수 있기 때문이다. Stateless가 Stateful을 참조할 경우에는 같은 입력에 대해 '참조한다'라는 같은 동작을 수행하기 때문에 Stateless지만 받은 응답은 서로 다른 응답일 수 있다. 즉, Stateless는 같은 입력에 대해 같은 동작을 행하는 것이자 상태에 영향을 받지 않는 것이고, Stateful은 같은 입력에 대해 다른 동작이 수행될 수 있고 상태에 영향을 받는 것이다.
따라서 Stateless는 항상 의도한대로 동작을 수행하지만 Stateful은 의도한 결과와는 다른 동작을 수행할 수도 있다. 요청에 따라 응답받는 결과 값은 Stateless가 Stateful을 참조할 경우 매번 달라질 수 있기 때문에 요청에 대해 같은 동작을 수행하는지로 Stateless와 Stateful을 구분한다. 또한 이때 판단 기준은 시스템 전체가 아닌 서버의 단일 개체를 보고 판단한다. 서버에서 입력이 주어졌을 때 같은 동작을 수행하고, 시스템 전체에서 봤을 때 서로 다른 값들을 받아왔더라도 같은 동작을 수행한다는 점에서 Stateless하다고 판단한다.

추가로 Stateless는 MSA에서 사용할 수 있지만 Stateful은 사용할 수 없다. Stateless가 Stateful을 참조하는 것은 가능하지만 Stateful 그 자체로 사용할 경우, 여러 상태에 따라 영향을 받을 수 있어서 요청에 대해 의도한 대로 동작을 수행하지 않을 수 있으므로 문제가 생길 수 있기 때문이다.
Stateful은 모놀리식에서는 사용이 가능하다. 서버가 1개이기 때문에 상태가 바뀌지 않아서 기존 상태에 따른 결과들을 얻기 때문이다.